webpackJsonp([19],{OULz:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("wbv5"),a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"Discussion mainCont"},[s("Header",{attrs:{title:"论述题"}}),t._v(" "),s("div",{staticStyle:{width:"50px",height:"50px",position:"relative","margin-top":"-50px"},on:{click:t.goBackInfo}}),t._v(" "),s("div",{staticClass:"headBox"},[s("h3",[s("span",{staticClass:"addTi",on:{click:t.openAddInfo}},[t._v("+")]),t._v("每道论述题分数为"),s("input",{directives:[{name:"model",rawName:"v-model",value:t.scores,expression:"scores"}],staticStyle:{"border-bottom":"1px dotted #555"},attrs:{disabled:""},domProps:{value:t.scores},on:{keyup:[t.scoreFun,t.keyUpFun],input:function(e){e.target.composing||(t.scores=e.target.value)}}}),t._v("分")])]),t._v(" "),s("div",{staticClass:"headBox"},[s("div",{staticClass:"head-title",staticStyle:{display:"inline"}},[t._v("科目：")]),t._v(" "),s("div",{staticClass:"block",staticStyle:{width:"79%","margin-left":"1%",display:"inline"}},t._l(t.SubjectsList,function(e,i){return s("el-radio-group",{key:i,staticStyle:{"margin-right":"8px",overflow:"hidden",display:"inline-block"},model:{value:t.subjradio1,callback:function(e){t.subjradio1=e},expression:"subjradio1"}},[s("el-radio",{attrs:{label:e._id}},[t._v(t._s(e.subjectName))])],1)})),t._v(" "),s("div",{staticStyle:{display:"inline"}},[s("el-button",{staticStyle:{width:"90px",display:"inline"},attrs:{type:"primary"},on:{click:t.submitSubjesc}},[t._v("查询")])],1)]),t._v(" "),s("div",{staticClass:"group-div"},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"题目关键字","prefix-icon":"el-icon-search"},model:{value:t.filterInput,callback:function(e){t.filterInput=e},expression:"filterInput"}},[s("el-button",{attrs:{slot:"append"},on:{click:t.onsearchHandle},slot:"append"},[t._v("搜索")])],1)],1),t._v(" "),s("div",{staticClass:"selectBox"},[s("div",{staticClass:"contentBox"},[s("h3",{staticStyle:{"border-bottom":"1px solid #ddd"}},[s("el-checkbox",{attrs:{checked:""},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选("+t._s(t.checkVal)+"/"+t._s(t.allVal)+")")])],1),t._v(" "),t.tagTotal<=0?s("div",{staticClass:"noInfo"},[t._m(0)]):t._e(),t._v(" "),t._l(t.filterBy(t.resData,t.filterInput),function(e,i){return s("div",{key:i,staticClass:"timuBox"},[s("div",{staticClass:"timu"},[s("el-checkbox-group",{on:{change:t.handleCheckedSingleChange},model:{value:e.checkedSingles,callback:function(s){t.$set(e,"checkedSingles",s)},expression:"item.checkedSingles"}},[s("h4",[s("el-checkbox",{staticStyle:{display:"inline-block"},attrs:{checked:e.checkedSingles}},[t._v(t._s(i+1)+"、"+t._s(e.questDesc))]),t._v(" "),s("span",{staticStyle:{float:"right"},on:{click:function(e){t.deleAnswers(i)}}},[s("img",{attrs:{src:"static/images/dele.png"}})]),t._v(" "),s("span",{staticStyle:{float:"right",color:"#bbb","margin-right":"1%"}},[t._v(t._s(t.scores)+"分")])],1)]),t._v(" "),s("div",{staticClass:"contAnswers"},[s("div",t._l(e.arr,function(e,i){return s("span",{key:i,staticStyle:{"vertical-align":"top",display:"inline-block","margin-right":"1%"}},[s("img",{staticStyle:{width:"100px"},attrs:{src:t.img_api+e.questImg},on:{click:t.showImages}})])})),t._v(" "),s("p",{staticStyle:{"font-size":"14px"}},[s("span",{staticStyle:{color:"#000"}},[t._v("答案：")]),t._v(t._s(e.questAnswer))])])],1)])})],2)]),t._v(" "),s("div",{staticClass:"selectBox",staticStyle:{"margin-bottom":"50px"}},[s("el-row",{staticStyle:{position:"fixed",bottom:"0",width:"100%","z-index":"999",background:"#fff"}},[s("el-button",{attrs:{type:"primary"},on:{click:t.submitInfo}},[t._v("提交")])],1)],1),t._v(" "),s("el-dialog",{attrs:{title:"查看图片",visible:t.imgDialogVisible,width:"80%",center:""},on:{"update:visible":function(e){t.imgDialogVisible=e}}},[t._v(" --\x3e\n\t\t\t"),s("span",[t._v("查看图片")]),t._v(" "),s("div",{attrs:{id:"imgDialogVisible"}},[s("img",{staticStyle:{width:"100%"},attrs:{src:t.targetImg,preview:"0","preview-text":"描述文字"}})]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.imgDialogVisible=!1}}},[t._v("确 定")])],1)]),t._v(" "),s("el-dialog",{attrs:{title:"新增论述题",visible:t.showAdd},on:{"update:visible":function(e){t.showAdd=e}}},[s("el-form",{attrs:{model:t.form}},[s("div",{staticClass:"head-div"},[s("div",{staticClass:"head-title"},[t._v("科目")]),t._v(" "),s("div",{staticClass:"block",staticStyle:{width:"79%","margin-left":"1%"}},t._l(t.SubjectsList,function(e,i){return s("el-radio-group",{key:i,staticStyle:{"margin-right":"8px",overflow:"hidden",display:"inline-block"},model:{value:t.subjradio,callback:function(e){t.subjradio=e},expression:"subjradio"}},[s("el-radio",{attrs:{label:e._id}},[t._v(t._s(e.subjectName))])],1)}))]),t._v(" "),s("span",{staticStyle:{"font-size":"14px"}},[t._v("每题分数："),s("b",{staticStyle:{color:"red"}},[t._v(t._s(t.scores))]),t._v("分")]),t._v(" "),s("el-form-item",{attrs:{label:"题目描述"}},[s("el-input",{attrs:{maxlength:"36",type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入题目描述，最多36个字"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"上传图片"}},[s("p",{staticClass:"addTip"},[t._v("*请上传图片，大小限制在3M内")]),t._v(" "),s("el-upload",{staticClass:"avatar-uploader",attrs:{headers:{accessToken:this.accessToken},"list-type":"picture","file-list":t.fileList,action:t.form.action,"show-file-list":!0,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload,name:"imgFile",data:{imgType:t.form.imgType},accept:"image/jpg,image/jpeg,image/png,image/gif"}},[s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t._v(" "),s("el-form-item",{attrs:{label:"正确答案"}},[s("el-input",{attrs:{maxlength:"255",type:"textarea",autosize:{minRows:3,maxRows:16},placeholder:"请输入答案，最多255个字"},model:{value:t.form.answers,callback:function(e){t.$set(t.form,"answers",e)},expression:"form.answers"}})],1),t._v(" "),s("el-button",{staticStyle:{width:"45%",display:"inline-block"},attrs:{type:"primary"},on:{click:t.AddInfo}},[t._v("确 定")]),t._v(" "),s("el-button",{staticStyle:{width:"45%",display:"inline-block"},on:{click:function(e){t.showAdd=!1}}},[t._v("取 消")])],1)],1),t._v(" "),s("el-dialog",{attrs:{visible:t.dialogTableVisible,center:"","show-close":!1},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[s("div",{staticClass:"success-dialog"},[s("div",{staticClass:"content"},[s("img",{attrs:{src:"static/images/success.png"}}),t._v(" "),s("div",{staticClass:"name"},[t._v(" 新增论述题成功")]),t._v(" "),t.sendMsgDisabled?s("div",{staticClass:"time"},[t._v(t._s(t.time+"s回到详情页")+">")]):t._e()]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticStyle:{width:"45%",display:"inline-block"},attrs:{type:"primary"},on:{click:t.openAddInfo}},[t._v("再加一个")]),t._v(" "),s("el-button",{staticStyle:{width:"45%",display:"inline-block"},on:{click:function(e){t.dialogTableVisible=!1}}},[t._v("知道了")])],1)])]),t._v(" "),s("div",{staticClass:"scoreAll"},[s("p",[s("span",{staticClass:"big"},[t._v(t._s(t.checkScore))]),t._v("\n\t\t\t\t/"),s("span",[t._v("100 ")])]),t._v(" "),s("p",[t._v("试卷分值")])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"default"},[e("img",{attrs:{src:"static/img/not-add-default.png",alt:""}}),this._v(" "),e("div",{staticClass:"not-class"},[this._v("\n\t\t\t\t\t\t\t暂无相关信息\n\t\t\t\t\t\t")])])}]};var n=function(t){s("xF9O")},o=s("VU/8")(i.a,a,!1,n,null,null);e.default=o.exports},wbv5:function(t,e,s){"use strict";(function(t){var i=s("fZjL"),a=s.n(i),n=s("Xxa5"),o=s.n(n),r=s("exGp"),l=s.n(r);e.a={name:"Discussion",props:{objDis:{type:Object}},data:function(){return{numVal:0,allVal:"",filterInput:"",questKind:"3",subjradio:"",subjradio1:"",SubjectsList:[],scores:3,checkScore:0,allScores:0,editBtn:0,dataVal:"",tagTotal:"",checkVal:0,checkAll:!1,showAdd:!1,dialogTableVisible:!1,imgDialogVisible:!1,targetImg:"",time:3,sendMsgDisabled:!1,accessToken:"",fileList:[],form:{name:"",action:"/edu/teach/uploadImg",imgType:2,answers:"",questImg:"",checkedSingles:!0},resData:[{}]}},methods:{goBackInfo:function(){var t={showPaperShow:!0,addPaperShow:!1};this.$emit("goBackInfo",t)},showImages:function(){this.targetImg=event.target.getAttribute("src"),this.imgDialogVisible=!0},handleAvatarSuccess:function(t,e){return 1e3===t.code?(this.successMsg("图片上传成功了"),this.form.questImg+=t.data.imgName+"ψ",this.showUpload=!1,this.fileList.push(this.img_api+t.data.imgName),!1):100===t.code?(this.dialog(t.message),this.$router.push({path:"/Login"}),!1):(this.dialog("图片没上传成功！请联系管理员或者再试一次"),!1)},beforeAvatarUpload:function(t){if(void 0==t)return this.dialog("请上传图片"),!1;var e=t.name.lastIndexOf("."),s=t.name.length,i=t.name.substring(e+1,s);return t.size/1024/1024<2?"jpg"!==i.toLowerCase()&&"png"!==i.toLowerCase()&&"jpeg"!==i.toLowerCase()&&"gif"!==i.toLowerCase()?(this.dialog("请上传图片文件"),this.filess="",!1):void 0:(this.dialog("上传文件大小不能超过 2MB!"),this.filess="",!1)},openAddInfo:function(){this.form.name="",this.form.answers="",this.form.img="",this.editBtn=-1,this.showAdd=!0},filterBy:function(t,e){return 0===e.length?(this.tagTotal=t.length,this.resData):(t=t.filter(function(t){if(t.questDesc.match(e))return t.questDesc.match(e)}),this.tagTotal=t.length,t)},AddInfo:function(){var t=this;return l()(o.a.mark(function e(){var s,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s={subjectId:t.subjradio,questKind:t.questKind,questDesc:"",questAnswer:"",questImg:t.form.questImg,itemList:[]},void 0,void 0,!(t.form.name.length<5||t.form.name.length>37)){e.next=4;break}return t.dialog("题目描述字数不能少于5个且不能多于36个！"),e.abrupt("return",!1);case 4:if(!(t.form.answers.length<1||t.form.answers.length>255)){e.next=7;break}return t.dialog("答案字数不能少于1个且不能多于255个！"),e.abrupt("return",!1);case 7:if(s.questDesc=t.form.name,s.questAnswer=t.form.answers,-1==t.editBtn){e.next=14;break}t.resData.splice(t.editBtn,1,s),console.log(t.resData[t.editBtn]),e.next=19;break;case 14:return e.next=16,t.$axioss.addQuestionItem(s);case 16:i=e.sent,console.log(i),1e3==i.data.code?(t.showAdd=!1,t.dialogTableVisible=!0,t.fileList=[],t.handleCheckedSingleChange(),t.getList()):t.dialog("添加没成功！再试一次");case 19:return e.abrupt("return",!1);case 20:case"end":return e.stop()}},e,t)}))()},editAnswers:function(t){this.showAdd=!0,this.form.name=this.resData[t].name,this.form.answers=this.resData[t].answers,this.form.img=this.resData[t].img,this.editBtn=t},addAnswers:function(){if(!(this.form.resData.length<6))return this.dialog("不能再添加了！"),!1;this.form.resData.push({title:"",content:"",answers:!1})},deleAnswers:function(t){this.checkVal;this.resData.length,this.resData.splice(t,1),this.handleCheckedSingleChange()},closeAnswers:function(t){if(t<1)return this.dialog("有且仅保留第一个答案，不能再删了！"),!1;this.form.resData.splice(t,1)},onsearchHandle:function(){},handleCheckAllChange:function(t){this.checkAll?this.resData.forEach(function(t,e){t.checkedSingles=!0}):this.resData.forEach(function(t,e){t.checkedSingles=!1}),this.scoreFun()},handleCheckedSingleChange:function(t){this.scoreFun()},keyUpFun:function(){},scoreFun:function(){var t=0,e=0,s=0,i=void 0,a=Number(this.scores);this.allVal=this.resData.length,this.resData.forEach(function(t,n){return!0===t.checkedSingles?(e+=a,s++):i=!1,i}),t=this.allVal*this.scores,this.checkAll=i,this.checkVal=s,this.allScores=t,this.checkScore=e},getList:function(t){var e=this;return l()(o.a.mark(function s(){var i,n,r;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i={questKind:e.questKind},[],[],[],i.subject=t||e.subjradio1.toString(),s.next=4,e.$axioss.getQuestionItemList(i);case 4:if(1100!==(n=s.sent).code){s.next=10;break}return e.dialog(n.message),s.abrupt("return",!1);case 10:if(1e3!==n.data.code){s.next=17;break}if(0!=a()(n.data.newArr.data).length){s.next=14;break}return e.resData=[],s.abrupt("return",!1);case 14:e.resData=n.data.newArr.data,e.objDis.parentData.length>0&&(r=e.objDis.parentData,e.scores=e.objDis.scores,e.resData.forEach(function(t,e){t.checkedSingles=!1,r.forEach(function(e,s){t.qcDesc===e.qcDesc&&(t.checkedSingles=!0)})})),e.scoreFun();case 17:case"end":return s.stop()}},s,e)}))()},submitInfo:function(){var t=this.resData,e=[],s={};s.tit=this.questKind,t.forEach(function(t,s){!0===t.checkedSingles&&e.push(t)}),s.score=this.checkScore,s.resData=e,this.$emit("getPaperInfo",s)},getSubjectMenuList:function(){var t=this;return l()(o.a.mark(function e(){var s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axioss.getSubjectMenuList();case 2:if(1e3!=(s=e.sent).data.code){e.next=8;break}return t.SubjectsList=s.data.data,t.subjradio1=s.data.data[0]._id,t.subjradio=s.data.data[0]._id,e.abrupt("return",t.subjradio1);case 8:case"end":return e.stop()}},e,t)}))()},submitSubjesc:function(){var t=this;return l()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.getList(t.subjradio1),e.abrupt("return",!1);case 2:case"end":return e.stop()}},e,t)}))()}},mounted:function(){t("footer").hide();var e=this;this.getSubjectMenuList().then(function(t){""===t&&null===t||e.getList(t)})},watch:{dialogTableVisible:function(t){if(t){var e=this;e.sendMsgDisabled=!0;var s=window.setInterval(function(){e.time--<=1&&(e.time=3,e.sendMsgDisabled=!1,e.dialogTableVisible=!1,window.clearInterval(s))},1e3)}}}}}).call(e,s("7t+N"))},xF9O:function(t,e){}});