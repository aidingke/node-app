webpackJsonp([22],{U0Pr:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("r78V"),n=e("Nl8x"),i={name:"commentform",data:function(){return{text:"",errors:""}},props:{postId:String},components:{TextArea:n.a},methods:{submit:function(){var t=this,s=this.$store.getters.user,e={text:this.text,name:s.name,avater:s.avater};this.$axios.post("/api/posts/comment/"+this.postId,e).then(function(s){t.errors="",t.text="",t.$emit("update")}).catch(function(s){t.errors=s.response.data})}}},o={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"post-form mb-3"},[e("div",{staticClass:"card card-info"},[e("div",{staticClass:"card-header bg-info text-white"},[t._v("\n        请鼓励一下我...\n        ")]),t._v(" "),e("div",{staticClass:"card-body"},[e("form",{on:{submit:function(s){return s.preventDefault(),t.submit(s)}}},[e("TextArea",{attrs:{name:"text",placeholder:"鼓励鼓励我...",error:t.errors.text},model:{value:t.text,callback:function(s){t.text=s},expression:"text"}}),t._v(" "),e("input",{staticClass:"btn btn-dark",attrs:{type:"submit"}})],1)])])])},staticRenderFns:[]},r=e("VU/8")(i,o,!1,null,null,null).exports,c={name:"commentfeed",props:{comment:Object,postId:String},computed:{user:function(){return this.$store.getters.user}},methods:{deleteClick:function(t){var s=this;this.$axios.delete("/api/posts/comment/"+this.postId+"/"+t).then(function(t){s.$emit("update")}).catch(function(t){console.log(t.response.data)})}}},l={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"comment"},[e("div",{staticClass:"card card-body mb-3"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-2"},[e("a",[e("img",{staticClass:"rounded-circle d-nonse d-md-block",staticStyle:{width:"150px"},attrs:{src:t.comment.avatar,alt:""}})]),t._v(" "),e("br"),t._v(" "),e("p",{staticClass:"text-center"},[t._v(t._s(t.comment.name))])]),t._v(" "),e("div",{staticClass:"col-md-10"},[e("p",{staticClass:"lead"},[t._v(t._s(t.comment.text))]),t._v(" "),null!=t.user&&t.user.id==t.comment.user?e("button",{staticClass:"btn btn-danger mr-1",attrs:{type:"button"},on:{click:function(s){t.deleteClick(t.comment._id)}}},[e("i",{staticClass:"fas fa-times"})]):t._e()])])])])},staticRenderFns:[]},u=e("VU/8")(c,l,!1,null,null,null).exports,d={name:"post",data:function(){return{errors:"",postData:null}},components:{CommentForm:r,PostFeed:a.a,CommentFeed:u},beforeRouteEnter:function(t,s,e){e(function(s){s.getPost(t.params.id)})},methods:{getPost:function(t){var s=this;this.$axios.get("/api/posts/"+t).then(function(t){s.postData=t.data,s.errors=""}).catch(function(t){s.postData=null,s.errors=t.response.data})}}},p={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"post"},[e("div",{staticClass:"container"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12"},[e("a",{staticClass:"btn btn-light",on:{click:function(s){s.preventDefault(),t.$router.go(-1)}}},[t._v("返回")]),t._v(" "),null!=t.postData?e("PostFeed",{attrs:{post:t.postData,showAction:!1}}):t._e(),t._v(" "),null!=t.postData?e("CommentForm",{attrs:{postId:t.postData._id},on:{update:function(s){t.getPost(t.postData._id)}}}):t._e(),t._v(" "),t._l(t.postData.comments,function(s){return null!=t.postData&&t.postData.comments.length>0?e("CommentFeed",{key:s._id,attrs:{comment:s,postId:t.postData._id},on:{update:function(s){t.getPost(t.postData._id)}}}):t._e()})],2)])])])},staticRenderFns:[]},m=e("VU/8")(d,p,!1,null,null,null);s.default=m.exports},r78V:function(t,s,e){"use strict";var a={name:"postfeed",data:function(){return{userLike:!1}},props:{post:Object,showAction:Boolean},computed:{user:function(){return this.$store.getters.user},findUserLike:function(){var t=this.$store.getters.user;return this.post.likes.length>0&&this.post.likes.filter(function(s){return s.user==t.id}).length>0}},methods:{deleteClick:function(t){var s=this;this.$axios.delete("/api/posts/"+t).then(function(t){s.$emit("update")}).catch(function(t){console.log(t.response.data)})},likeClick:function(t){var s=this;this.$axios.post("/api/posts/like/"+t).then(function(t){s.$emit("update")}).catch(function(t){alert(t.response.data.alreadyliked)})},unLikeClick:function(t){var s=this;this.$axios.post("/api/posts/unlike/"+t).then(function(t){s.$emit("update")}).catch(function(t){alert(t.response.data.notliked)})}}},n={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"posts"},[e("div",{staticClass:"card card-body mb-3"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-2"},[e("a",[e("img",{staticClass:"rounded-circle d-nonse d-md-block",staticStyle:{width:"70px"},attrs:{src:"/static/avatar/"+t.post.user.avatar,alt:""}})]),t._v(" "),e("br"),t._v(" "),e("p",{staticClass:"text-center"},[t._v(t._s(t.post.name))])]),t._v(" "),e("div",{staticClass:"col-md-10"},[e("p",{staticClass:"lead",domProps:{innerHTML:t._s(t.post.text)}}),t._v(" "),t.showAction?e("span",[e("button",{staticClass:"btn btn-light mr-1",attrs:{type:"button"},on:{click:function(s){t.likeClick(t.post._id)}}},[e("i",{staticClass:"fas fa-thumbs-up",class:{"text-info":t.findUserLike}}),t._v(" "),e("span",{staticClass:"badge badge-light"},[t._v(t._s(t.post.likes.length))])]),t._v(" "),e("button",{staticClass:"btn btn-light mr-1",attrs:{type:"button"},on:{click:function(s){t.unLikeClick(t.post._id)}}},[e("i",{staticClass:"text-secondary fas fa-thumbs-down"})]),t._v(" "),null!=t.user&&t.user.id==t.post.user?e("button",{staticClass:"btn btn-danger mr-1",attrs:{type:"button"},on:{click:function(s){t.deleteClick(t.post._id)}}},[e("i",{staticClass:"fas fa-times"})]):t._e()]):t._e()])])])])},staticRenderFns:[]},i=e("VU/8")(a,n,!1,null,null,null);s.a=i.exports}});